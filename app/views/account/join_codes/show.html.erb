<% @page_title = "Join Code" %>

<div class="max-w-2xl py-4 prose mx-auto">
  <h1>Join Code</h1>

  <p class="lead">Share this link to invite people to this account.</p>

  <div class="card bg-base-200 p-6 my-6">
    <div class="form-control">
      <label class="label">
        <span class="label-text font-semibold">Shareable Link</span>
      </label>
      <div class="join w-full">
        <input type="text"
               value="<%= @join_code.join_url %>"
               class="input input-bordered join-item flex-1"
               readonly
               id="join-link-input" />
        <button class="btn btn-primary join-item"
                onclick="navigator.clipboard.writeText(document.getElementById('join-link-input').value); this.textContent='Copied!'; setTimeout(() => this.textContent='Copy', 2000)">
          Copy
        </button>
      </div>
    </div>
  </div>

  <div class="stats shadow my-6">
    <div class="stat">
      <div class="stat-title">Usage</div>
      <div class="stat-value"><%= @join_code.usage_count %>/<%= @join_code.usage_limit %></div>
      <div class="stat-desc">
        <% if @join_code.active? %>
          <%= @join_code.usage_limit - @join_code.usage_count %> remaining
        <% else %>
          <span class="text-error">No uses remaining</span>
        <% end %>
      </div>
    </div>
    <div class="stat">
      <div class="stat-title">Code</div>
      <div class="stat-value text-lg font-mono"><%= @join_code.code %></div>
      <div class="stat-desc">
        <% if @join_code.active? %>
          <span class="text-success">Active</span>
        <% else %>
          <span class="text-error">Inactive</span>
        <% end %>
      </div>
    </div>
  </div>

  <% if Current.user&.admin? %>
    <div class="flex gap-4 my-6">
      <%= link_to "Edit Limit", edit_account_join_code_path, class: "btn btn-outline" %>
      <%= button_to "Reset Code", account_join_code_path, method: :delete, class: "btn btn-error btn-outline",
          data: { confirm: "This will generate a new code and reset usage count. Continue?" } %>
    </div>
  <% end %>
</div>
